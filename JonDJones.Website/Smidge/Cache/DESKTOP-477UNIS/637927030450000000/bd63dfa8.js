(function(){"use strict";function listSnapshotsController($scope,$rootScope,$q,uSyncSnapshotService,uSyncHub,uSyncExpansionService,notificationsService,editorService){function getSnapshots(){uSyncSnapshotService.getSnapshots().then(function(result){vm.snapshots=result.data;vm.loading=!1})}function apply(alias){vm.working=!0;vm.reported=!1;vm.action="Import";uSyncSnapshotService.apply(alias,getClientId()).then(function(result){vm.working=!1;vm.reported=!0;vm.results=result.data;$rootScope.$broadcast("usync-snapshot-reloaded")},function(error){vm.working=!1;notificationsService.error("Error",error.data.ExceptionMessage)})}function applyAll(){vm.working=!0;vm.reported=!1;vm.action="Import";uSyncSnapshotService.applyAll(getClientId()).then(function(result){vm.working=!1;vm.reported=!0;vm.results=result.data;$rootScope.$broadcast("usync-snapshot-reloaded")},function(error){vm.working=!1;notificationsService.error("Error",error.data.ExceptionMessage)})}function report(alias){vm.working=!0;vm.reported=!1;vm.action="Report";uSyncSnapshotService.report(alias,getClientId()).then(function(result){vm.working=!1;vm.reported=!0;vm.results=result.data},function(error){vm.working=!1;notificationsService.error("error",error.data.ExceptionMessage)})}function reportAll(){vm.working=!0;vm.reported=!1;vm.action="Report";uSyncSnapshotService.reportAll(getClientId()).then(function(result){vm.working=!1;vm.reported=!0;vm.results=result.data},function(error){vm.working=!1;notificationsService.error("error",error.data.ExceptionMessage)})}function remove(alias){vm.loading=!0;uSyncSnapshotService.remove(alias).then(function(){getSnapshots()},function(error){vm.working=!1;notificationsService.error("error",error.data.ExceptionMessage)})}function download(alias){uSyncSnapshotService.download(alias).then(function(){vm.buttonState="success"},function(error){vm.buttonState="error";notificationsService.error("error",error.data.ExceptionMessage)})}function downloadAll(){uSyncSnapshotService.downloadAll().then(function(){vm.buttonState="success"},function(error){vm.buttonState="error";notificationsService.error("error",error.data.ExceptionMessage)})}function importDialog(){editorService.open({title:"Import Snapshot File",view:"/App_Plugins/uSyncSnapshots/dialog/importDialog.html",size:"small",submit:function(){editorService.close();$rootScope.$broadcast("usync-snapshot-reloaded")},close:function(){editorService.close()}})}function initHub(){var defer=$q.defer();return uSyncHub.initHub(function(hub){vm.hub=hub;vm.hub.on("add",function(data){vm.status=data});vm.hub.on("update",function(update){vm.update=update});vm.hub.start(function(result){defer.resolve("complete "+result)})}),defer.promise}function getClientId(){return $.connection!==undefined?$.connection.connectionId:""}var vm=this,promises;vm.loading=!0;vm.snapshots=[];vm.importDisabled=Umbraco.Sys.ServerVariables.uSyncSnapshots.importDisabled;vm.getSnapshots=getSnapshots;vm.remove=remove;vm.apply=apply;vm.download=download;vm.downloadAll=downloadAll;vm.importDialog=importDialog;vm.applyAll=applyAll;vm.report=report;vm.reportAll=reportAll;vm.working=!1;vm.action="report";vm.results=[];vm.reported=!1;vm.licenced=!0;uSyncExpansionService.isLicenced("snapshots","8.0.0").then(function(result){vm.licenced=result.data});promises=[initHub()];$q.all(promises).then(function(){getSnapshots()});$scope.$on("usync-snapshot-reloaded",function(){vm.getSnapshots()})}var listSnapshotsComponent={templateUrl:Umbraco.Sys.ServerVariables.application.applicationPath+"App_Plugins/uSyncSnapshots/components/listSnapshotsComponent.html",controllerAs:"vm",controller:listSnapshotsController};angular.module("umbraco").component("usyncSnapshotsList",listSnapshotsComponent)})()